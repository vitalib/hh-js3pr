!function(t){var e={};function s(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,s),o.l=!0,o.exports}s.m=t,s.c=e,s.d=function(t,e,n){s.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},s.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},s.t=function(t,e){if(1&e&&(t=s(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(s.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)s.d(n,o,function(e){return t[e]}.bind(null,o));return n},s.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return s.d(e,"a",e),e},s.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},s.p="",s(s.s=0)}([function(t,e,s){const{selectionMachine:n}=s(1),[o,r,i,a,l,c]=[40,38,13,37,39,32],h=document.getElementsByClassName("selector-input")[0];h.addEventListener("keyup",function(t){t.keyCode===i?n.transition("enter"):t.keyCode==r||t.keyCode==o?n.transition("upDownKeys",{keyCode:t.keyCode}):t.keyCode==a||t.keyCode==c||t.keyCode==l?t.preventDefault():n.transition("input",t)}),h.addEventListener("keydown",function(t){t.keyCode!=a&&t.keyCode!=l&&t.keyCode!=r&&t.keyCode!=c&&t.keyCode!=o||t.preventDefault()})},function(t,e,s){const{machine:n,useContext:o,useState:r}=s(2),i=n({id:"selector",initialState:"noProposals",context:{prevInput:"",prevState:"",inputSelectorClass:"selector-input",proposalListClass:"proposal-list",selectedTownsClass:"selected-towns",suggestList:[],selectedAreas:[]},states:{noProposals:{onEntry(t){const[e,s]=o(),n=document.getElementsByClassName(e.proposalListClass)[0];for(;n.firstChild;)n.removeChild(n.firstChild)},on:{input:{service:t=>{const[e,s]=r(),[n,i]=o(),a=document.getElementsByClassName(n.selectedTownsClass)[0],l=n.selectedAreas;8==t.keyCode&&!n.prevInput&&l.length?(a.removeChild(a.lastChild),l.pop(),i({selectedAreas:l}),s("noProposals")):(i({prevState:e}),s("request"))}},upDownKeys:{target:"noProposals"},enter:{target:"noProposals"}}},request:{onEntry(t){const[e,s]=r(),[n,i]=o(),a=document.getElementsByClassName(n.inputSelectorClass)[0].value;if(a.length<2)return s("noProposals"),void i({prevInput:a});if(n.prevInput===a)return void s(n.prevState);let l=new URL("https://api.hh.ru/suggests/areas"),c={text:a};l.search=new URLSearchParams(c),window.fetch(l).then(t=>{if(t.ok)return t.json();throw Error(`Request rejected with status ${t.status}`)}).then(t=>{const e=t.items.map(t=>t.text);0==e.length?s("noProposals"):(i({suggestList:e}),s("display"))}).catch(t=>{console.log(t),s("noProposals")}),i({prevInput:a})},on:{input:{target:"noProposals"},upDownKeys:{target:"noProposals"},enter:{target:"noProposals"}}},display:{onEntry(t){const[e,s]=o(),n=document.getElementsByClassName(e.proposalListClass)[0];for(;n.firstChild;)n.removeChild(n.firstChild);const r=e.suggestList;for(let t of r){let e=document.createElement("li");e.className="proposal-element",e.appendChild(document.createTextNode(t)),n.appendChild(e)}const i=n.firstChild;i.classList.add("highlighted"),s({highlighted:i.innerText})},on:{input:{service:t=>{const[e,s]=r(),[n,i]=o();i({prevState:e}),s("request")}},upDownKeys:{service:t=>{const[e,s]=o(),n=document.getElementsByClassName(e.proposalListClass)[0];if(n.children.length<2)return;let r;const i=document.getElementsByClassName("highlighted")[0];r=38===t.keyCode?i==n.firstChild?n.lastChild:i.previousSibling:i==n.lastChild?n.firstChild:i.nextSibling,i.classList.remove("highlighted"),r.classList.add("highlighted"),s({highlighted:r.innerText})}},enter:{service:t=>{const[e,s]=o(),n=document.getElementsByClassName(e.selectedTownsClass)[0],i=e.selectedAreas,a=e.highlighted;if(i.includes(a))return;i.push(a),s({selectedAreas:i});const l=document.createElement("div");l.className="town",l.appendChild(document.createTextNode(e.highlighted)),n.appendChild(l);const[c,h]=r();document.getElementsByClassName(e.inputSelectorClass)[0].value="",s({prevInput:""}),h("noProposals")}}}}}});t.exports={selectionMachine:i}},function(t,e,s){const{MachineStack:n}=s(3);class o{constructor(t){this.id=t.id,this.context=t.context,this.currentState=t.initialState,this.states=t.states,this.actions=t.actions}transition(t,e){const s=this.states[this.currentState],n=s.on[t];if(!n)throw new Error(`Event ${t} for state`+` ${this.currentState}  doesn't exists`);return Promise.resolve(this).then(()=>{s.hasOwnProperty("onExit")&&this.callActions("onExit",e)}).then(()=>{const t=n.service;if(t)this.callService(t,e);else{let t=this.getTargetState(n);this.setState(t)}return this}).catch(t=>{throw t})}getTargetState(t){if(t.hasOwnProperty("target"))return t.target;throw new Error("Target state for machine"+` ${this.id} is not specified.`)}setContext(t){Object.assign(this.context,t)}setState(t){if(!this.states.hasOwnProperty(t))throw new Error(`Target state "${t}"`+` for machine ${this.id} is incorrect.`);this.currentState=t,this.states[t].hasOwnProperty("onEntry")&&this.callActions("onEntry")}getActionByItsName(t){if(!this.actions.hasOwnProperty(t))throw new Error(`Action "${action}" is unavailable`);return this.actions[t]}callService(t,e){o.machinesStack.push(this),t(e),o.machinesStack.pop()}callActions(t,e){const s=[],n=this.states[this.currentState][t];if("string"==typeof n)s.push(this.getActionByItsName(n));else if("function"==typeof n)s.push(n);else for(let t of n)"function"==typeof t?s.push(t):"string"==typeof t&&s.push(this.getActionByItsName(t));for(let t of s)o.machinesStack.push(this),t(e),o.machinesStack.pop()}}o.machinesStack=new n,t.exports={machine:function(t){return new o(t)},useContext:function(){let t=o.machinesStack.getTopElement();return[t.context,e=>t.setContext(e)]},useState:function(){let t=o.machinesStack.getTopElement();return[t.currentState,e=>t.setState(e)]}}},function(t,e){t.exports={MachineStack:class{constructor(){this.stack=[],this.length=0}push(t){this.stack.push(t),this.length++}pop(){if(this.isEmpty())throw new Error("Stack is empty");return this.length--,this.stack.pop()}isEmpty(){return 0===this.length}getTopElement(){if(this.isEmpty())throw new Error("Stack is empty");return this.stack[this.length-1]}}}}]);